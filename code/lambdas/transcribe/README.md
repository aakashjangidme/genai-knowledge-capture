# Amazon Transcribe Batch Lambda

## Introduction

This lambda triggers Amazon Transcribe batch jobs, generating texts from a list of audio files.

## Component Details
#### Prerequisites
* [Python 3.12](https://www.python.org/downloads/release/python-3120/) or later
* [AWS Lambda Powertools 2.32.0](https://docs.powertools.aws.dev/lambda/python/2.32.0/)

#### Technology stack
- [AWS Lambda](https://aws.amazon.com/lambda/)
- [Amazon Transcribe](https://aws.amazon.com/transcribe/)
- [Amazon S3](https://aws.amazon.com/s3/)

#### Package Details

| Files                                                                    | Description                                                                                                                                                                                                                          |
| ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| [connections.py](connections.py)                                         | Python file with `Connections` class for establishing connections with external dependencies of the lambda                                                                                                                           |
| [s3url.py](s3url.py)         | Python file containing util function to parse s3 url                                                   |
| [transcribe_batch.py](transcribe_batch.py) | Python file containing the `lambda_handler` function that acts as the starting point for AWS Lambda invocation                                                                                                                       |


#### Input

Input is received from [Preprocess AWS Lambda](../../preprocess), which runs before this Lambda the AWS Step Function.

```json
{
  "statusCode": 200,
  "audioFilesS3Uris": list,
  "documentName": string,
  "serviceName": string
}

```
| Field            | Description                                                                                                            | Data Type |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------- | --------- |
| `statusCode`     | A HTTP status code that denotes the output status of validation. A `200` value means validation completed successfully | Number    |
| `audioFilesS3Uris`        | List of URIs pointing to audio files                                                             | List   |
| `documentName` | User input document name                               | String    |
| `serviceName`    | The name of the AWS Lambda as configured through AWS Powertools across log statements                                                                 | String    |


#### Output

```json
{
  "statusCode": 200,
  "transcribedFilesS3Uris": list,
  "documentName": string,
  "serviceName": string
}

```

| Field            | Description                                                                                                            | Data Type |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------- | --------- |
| `statusCode`     | A HTTP status code that denotes the output status of validation. A `200` value means validation completed successfully | Number    |
| `transcribedFilesS3Uris` | List of S3 URIs of answer texts generated by Amazon Transcribe                              | List    |
| `documentName`        | User input document name                                                             | String   |
| `serviceName`    | The name of the AWS Lambda as configured through AWS Powertools across log statements                                                                 | String    |

#### Environmental Variables

| Field                          | Description                                                                              | Data Type |
| ------------------------------ | ---------------------------------------------------------------------------------------- | --------- |
| `POWERTOOLS_LOG_LEVEL`         | Sets how verbose Logger should be (INFO, by default)                                     | String    |
| `DATA_SOURCE_BUCKET_NAME` | S3 bucket where audio files are stored                              | String    |
| `POWERTOOLS_SERVICE_NAME`      | Sets service key that will be present across all log statements                          | String    |
| `AWS_REGION`      | AWS Region where the solution is deployed                          | String    |
