# Summarize Lambda

## Introduction

The primary objective of this AWS Lambda is to generate summary of multiple relevant answers received for a given question. This AWS Lambda uses Large Language Models from Amazon Bedrock service to generate the summary.

## Component Details

#### Prerequisites

- [Python 3.12](https://www.python.org/downloads/release/python-3120/) or later
- [AWS Lambda Powertools 2.35.1](https://docs.powertools.aws.dev/lambda/python/2.35.1/)

#### Technology stack

- [AWS Lambda](https://aws.amazon.com/lambda/)
- [Amazon Bedrock](https://aws.amazon.com/bedrock/)
- [Amazon S3](https://aws.amazon.com/s3/)

#### Package Details

| Files                                      | Description                                                                                                    |
| ------------------------------------------ | -------------------------------------------------------------------------------------------------------------- |
| [connections.py](connections.py)           | Python file with `Connections` class for establishing connections with external dependencies of the lambda     |
| [exceptions.py](exceptions.py)             | Python file containing custom exception classes `CodeError` and `ConnectionError`                              |
| [summarize.py](dumarize.py)     | Python file containing the `lambda_handler` function that acts as the starting point for AWS Lambda invocation |
| [prompt_templates.py](prompt_templates.py) | Python variables with input Prompts for the LLM to operate                                                     |
| [summarization.py](summarization.py)       | Python utility class for performing answer summary using Amazon Bedrock service                                |
| [utils.py](utils.py)                       | Python utility file containing reusable methods                                                                |

#### Input

The AWS Lambda is part of a AWS Step Function and it requires following string as input. The input for the lambda is received from [Validation AWS Lambda](../gp-eda-doc-generation-validation) that runs before this Lambda in Answer Analysis AWS Step Function.

```json
{
  "statusCode": int,
  "documentName": str,
  "validAnswersS3Uris": List,
  "continueSummarization": Bool,
  "invalidAnswersS3Uris": List,
  "serviceName": 'app-summarize'
}
```

| Field            | Description                                                                                      | Data Type |
| ---------------- | ------------------------------------------------------------------------------------------------ | --------- |
| `statusCode` | A HTTP status code that denotes the output status of validation. A `200` value means validation completed successfully| String    |
| `documentName` | User input document name  | String    |
| `validAnswersS3Uris` | The s3 uris of valid answers generated by transcribe | String    |
| `continueSummarization` | Boolean to indicate if summarization step should be performed | Boolean    |
| `invalidAnswersS3Uris` | The s3 uris of invalid answers generated by transcribe | String    |
| `serviceName` | The name of the AWS Lambda as configured through AWS Powertools across log statements | String    |

#### Output

The AWS Lambda is part of a AWS Step Function and it generates the following JSON as output.

```json
{
  statusCode: int
  documentName: str
  summarizedAnswerS3Uri: str
  serviceName: 'app-summarize'
}
```

| Field                  | Description                                                                                                            | Data Type |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------- | --------- |
| `statusCode`           | A HTTP status code that denotes the output status of validation. A `200` value means validation completed successfully | Number    |
| `documentName`               | User input document name                                       | String    |
| `summarizedAnswerS3Uri`       | The s3 uri of the folder in which answer summary output are stored                                                     | String    |
| `serviceName`          | The name of the AWS Lambda as configured through AWS Powertools across log statements                                      | String    |

#### Environmental Variables

| Field                     | Description                                                     | Data Type |
| ------------------------- | --------------------------------------------------------------- | --------- |
| `POWERTOOLS_LOG_LEVEL`    | Sets how verbose Logger should be (INFO, by default)            | String    |
| `DATA_SOURCE_BUCKET_NAME` | S3 bucket where audio files are stored                          | String    |
| `POWERTOOLS_SERVICE_NAME` | Sets service key that will be present across all log statements | String    |
| `POWERTOOLS_METRICS_NAMESPACE` | Sets namespace key that will be present across metrics log | String    |
| `AWS_REGION`              | AWS Region where the solution is deployed                       | String    |
